<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Tracker | Viva Picks</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <nav>
        <div class="container">
            <div class="logo">
                <div class="logo-icon">V</div>
                Viva Picks
            </div>
            <div class="nav-links">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="width: 35px; height: 35px; background: #333; border-radius: 50%;"></div>
                    <span>Welcome, User</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="dashboard-container container">
        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li><a href="dashboard">ðŸ“Š SIGNAL FEED</a></li>
                <li><a href="warroom">ðŸ“¡ WAR ROOM</a></li>
                <li><a href="linetracker" class="active" style="color: var(--primary);">ðŸ“ˆ LINE TRACKER</a></li>
                <li><a href="account">ðŸ’³ ACCOUNT STATUS</a></li>
                <li id="admin-link" style="display: none;"><a href="admin"
                        style="color: var(--primary); border-color: var(--primary);">ðŸ”’ OPERATOR PANEL</a></li>
                <li><a href="/" onclick="document.cookie='token=; Max-Age=0'">ðŸšª TERMINATE SESSION</a></li>
            </ul>
        </aside>

        <main class="main-content">
            <div class="glass-panel" style="padding: 1.5rem; margin-bottom: 2rem;">
                <div
                    style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1.5rem;">
                    <div>
                        <h1 style="margin: 0; font-size: 1.5rem;">Live Market Lines</h1>
                        <p style="color: var(--text-muted); margin:0; font-size:0.9rem;">Real-time Odds & Spreads
                            (Consensus)</p>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <select id="line-sport-select" class="form-control"
                            style="width: auto; background:#111; color:white; border:1px solid #333;">
                            <option value="NBA">NBA</option>
                            <option value="NFL">NFL</option>
                            <option value="UFC">UFC</option>
                            <option value="MLB">MLB</option>
                            <option value="NHL">NHL</option>
                            <option value="NCAAF">NCAAF</option>
                            <option value="NCAAB">NCAAB</option>
                            <option value="EPL">EPL</option>
                        </select>
                        <button onclick="fetchPublicLines()" class="btn btn-primary"
                            style="font-size:0.8rem; padding: 0.8rem 1.5rem;">LOAD LINES</button>
                    </div>
                </div>
                <div id="lines-status"
                    style="margin-top:10px; font-size:0.8rem; color:var(--text-muted); text-align:right; font-family:var(--font-mono);">
                </div>
            </div>

            <div id="lines-grid"
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                <!-- Cards will go here -->
                <div
                    style="grid-column:1/-1; text-align:center; padding:3rem; color:var(--text-muted); border:1px dashed #333; border-radius:8px;">
                    Select a sport and click LOAD LINES to view live spreads and money lines.
                </div>
            </div>

            <div style="margin-top: 2rem; text-align: center; color: var(--text-muted); font-size: 0.8rem;">
                Data Source: The Odds API (Simulated Consensus). Caches for 60m to optimize performance.
            </div>
        </main>
    </div>

    <script src="script.js"></script>
    <script>
        async function fetchPublicLines() {
            const sport = document.getElementById('line-sport-select').value;
            const grid = document.getElementById('lines-grid');
            const status = document.getElementById('lines-status');

            grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:3rem;"><div class="ticker-item"><span>LOADING MARKET DATA...</span></div></div>';
            status.textContent = 'Fetching...';

            try {
                const res = await fetch(`/api/public/lines/${sport}`);
                const json = await res.json();

                if (!res.ok) throw new Error(json.error || 'Failed to fetch');

                status.textContent = `Data Source: ${json.source === 'cache' ? 'Cached (Fast)' : 'Live API (Fresh)'}`;
                status.style.color = json.source === 'cache' ? 'var(--text-muted)' : 'var(--accent)';

                if (json.data.length === 0) {
                    grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:3rem; color:var(--text-muted);">No lines available right now for this sport.</div>';
                    return;
                }

                grid.innerHTML = '';
                json.data.forEach(game => {
                    const card = document.createElement('div');
                    card.className = 'glass-panel';
                    card.style.padding = '1.2rem';
                    card.style.position = 'relative';

                    // Simple animation
                    card.style.animation = 'fadeIn 0.5s ease';

                    card.innerHTML = `
                        <div style="display:flex; justify-content:space-between; border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:10px;">
                            <span style="color:#888; font-size:0.75rem; font-family:var(--font-mono);">${new Date(game.time).toLocaleString([], { weekday: 'short', hour: '2-digit', minute: '2-digit' })}</span>
                             <span style="color:var(--primary); font-family:var(--font-mono); font-size:0.75rem; font-weight:bold;">${sport}</span>
                        </div>
                        <div style="margin-bottom:1.2rem;">
                            <div style="font-weight:700; font-size:1.1rem; color:white; margin-bottom:5px;">${game.away_team}</div>
                            <div style="display:flex; justify-content:space-between; font-size:0.85rem; font-family:var(--font-mono); background:rgba(255,255,255,0.05); padding:8px; border-radius:4px;">
                                <span style="color:#aaa;">ML: <span style="color:white; font-weight:bold;">${game.away_money}</span></span>
                                <span style="color:#aaa;">Spr: <span style="color:${game.away_spread.includes('-') ? '#f97316' : 'white'}; font-weight:bold;">${game.away_spread}</span></span>
                            </div>
                        </div>
                         <div>
                            <div style="font-weight:700; font-size:1.1rem; color:white; margin-bottom:5px;">${game.home_team}</div>
                            <div style="display:flex; justify-content:space-between; font-size:0.85rem; font-family:var(--font-mono); background:rgba(255,255,255,0.05); padding:8px; border-radius:4px;">
                                 <span style="color:#aaa;">ML: <span style="color:white; font-weight:bold;">${game.home_money}</span></span>
                                <span style="color:#aaa;">Spr: <span style="color:${game.home_spread.includes('-') ? '#f97316' : 'white'}; font-weight:bold;">${game.home_spread}</span></span>
                            </div>
                        </div>
                    `;
                    grid.appendChild(card);
                });

            } catch (e) {
                grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; color:#ff5252; padding:3rem; border:1px solid #ff5252;">Error: ${e.message}</div>`;
            }
        }
    </script>
</body>

</html>