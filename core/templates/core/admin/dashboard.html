{% extends "core/base.html" %}

{% block title %}Admin · Viva Picks{% endblock %}

{% block content %}
  <div class="flex flex-col justify-between gap-6 sm:flex-row sm:items-end">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight sm:text-3xl">Admin dashboard</h1>
      <p class="mt-2 text-sm text-slate-400">Manage picks and monitor subscription activity.</p>
    </div>
    <div class="flex flex-wrap gap-3">
      <a href="{% url 'admin_pick_create' %}" class="rounded-xl bg-white px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-200">
        New pick
      </a>
      <a href="{% url 'admin_health' %}" class="rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10">
        Health
      </a>
      <a href="{% url 'admin_email_test' %}" class="rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10">
        Test email
      </a>
      <a href="/dj-admin/" class="rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10">
        Django admin
      </a>
    </div>
  </div>

  <div class="mt-10 grid gap-6 lg:grid-cols-3">
    <section class="rounded-2xl border border-white/10 bg-white/[0.03] p-6 lg:col-span-2">
      <div class="flex items-end justify-between gap-4">
        <div>
          <h2 class="text-lg font-semibold">Picks</h2>
          <p class="mt-1 text-sm text-slate-400">Latest content posted to members.</p>
        </div>
        <div class="text-xs font-semibold text-slate-400">
          Active subscribers: {{ active_subscriber_count }}
        </div>
      </div>

      <div class="mt-6 overflow-hidden rounded-2xl border border-white/10">
        <div class="grid grid-cols-12 bg-white/5 px-5 py-3 text-xs font-semibold uppercase tracking-wide text-slate-400">
          <div class="col-span-5">Title</div>
          <div class="col-span-2">Sport</div>
          <div class="col-span-2">Result</div>
          <div class="col-span-3 text-right">Actions</div>
        </div>
        <div class="divide-y divide-white/10 bg-white/[0.02]">
          {% for pick in picks %}
            <div class="grid grid-cols-12 items-center px-5 py-4">
              <div class="col-span-5">
                <div class="text-sm font-semibold">{{ pick.title }}</div>
                <div class="mt-1 text-xs text-slate-500">{{ pick.created_at|date:"M j, Y" }}</div>
              </div>
              <div class="col-span-2 text-sm text-slate-300">{{ pick.sport }}</div>
              <div class="col-span-2 text-sm text-slate-300">{{ pick.result|upper }}</div>
              <div class="col-span-3 flex justify-end gap-2">
                <a href="{% url 'admin_pick_send' pick.id %}" class="rounded-lg border border-emerald-500/30 bg-emerald-500/10 px-3 py-2 text-xs font-semibold text-emerald-200 hover:bg-emerald-500/20">Send</a>
                <a href="{% url 'admin_pick_edit' pick.id %}" class="rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-xs font-semibold text-white hover:bg-white/10">Edit</a>
                <a href="{% url 'admin_pick_delete' pick.id %}" class="rounded-lg border border-rose-500/30 bg-rose-500/10 px-3 py-2 text-xs font-semibold text-rose-200 hover:bg-rose-500/20">Delete</a>
              </div>
            </div>
          {% empty %}
            <div class="px-5 py-6 text-sm text-slate-300">No picks yet.</div>
          {% endfor %}
        </div>
      </div>
    </section>

    <section class="rounded-2xl border border-white/10 bg-white/[0.03] p-6">
      <h2 class="text-lg font-semibold">Recent subscriptions</h2>
      <p class="mt-1 text-sm text-slate-400">Most recently updated Stripe status.</p>

      <div class="mt-6 space-y-3">
        {% for s in subs %}
          <div class="rounded-2xl border border-white/10 bg-black/20 p-4">
            <div class="flex items-center justify-between gap-4">
              <div>
                <div class="text-sm font-semibold">{{ s.user.username }}</div>
                <div class="mt-1 text-xs text-slate-500">
                  {% if s.user.email %}{{ s.user.email }} · {% endif %}{{ s.updated_at|date:"M j, Y" }}
                </div>
              </div>
              <div class="rounded-full px-3 py-1 text-xs font-semibold bg-white/5 text-slate-200 border border-white/10">
                {{ s.status|upper }}
              </div>
            </div>
          </div>
        {% empty %}
          <div class="text-sm text-slate-300">No subscription updates yet.</div>
        {% endfor %}
      </div>
    </section>

    <section class="rounded-2xl border border-white/10 bg-white/[0.03] p-6 lg:col-span-3">
      <h2 class="text-lg font-semibold">Broadcast history</h2>
      <p class="mt-1 text-sm text-slate-400">Most recent sends to active subscribers.</p>

      <div class="mt-6 overflow-hidden rounded-2xl border border-white/10">
        <div class="grid grid-cols-12 bg-white/5 px-5 py-3 text-xs font-semibold uppercase tracking-wide text-slate-400">
          <div class="col-span-6">Subject</div>
          <div class="col-span-3">Pick</div>
          <div class="col-span-1 text-right">Sent</div>
          <div class="col-span-2 text-right">Recipients</div>
        </div>
        <div class="divide-y divide-white/10 bg-white/[0.02]">
          {% for b in broadcasts %}
            <div class="grid grid-cols-12 items-center px-5 py-4">
              <div class="col-span-6 text-sm font-semibold">{{ b.subject }}</div>
              <div class="col-span-3 text-sm text-slate-300">{{ b.pick.title }}</div>
              <div class="col-span-1 text-right text-sm text-slate-300">{{ b.sent_at|date:"M j" }}</div>
              <div class="col-span-2 text-right text-sm text-slate-300">{{ b.recipient_count }}</div>
            </div>
          {% empty %}
            <div class="px-5 py-6 text-sm text-slate-300">No broadcasts yet.</div>
          {% endfor %}
        </div>
      </div>
    </section>
  </div>
{% endblock %}
